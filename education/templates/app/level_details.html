{% extends "base.html" %}

{% block content %}
<div class="level_details">

  <div class="progress-bar sticky-progress">
    {% for lq in level_questions %}
      <div class="progress-square {% if lq.id in completed_ids %}done{% endif %}">
        {% if lq.id in completed_ids %}
          ✔
        {% else %}
          {{ forloop.counter }}
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <div class="question-block">
    {# Основной текст вопроса всегда показываем #}
    <p class="question-text" title="{{ current_question.translation|default:'' }}">
      {{ current_question.text }}
    </p>

    {# Если есть связанные фразы — показываем их ниже #}
    {% if current_question.phrases.exists %}
      <div class="question-phrases">
        {% for phrase in current_question.phrases.all %}
          <p class="question-text" title="{{ phrase.translation|default:'' }}">
            {{ phrase.text }}
          </p>
        {% endfor %}
      </div>
    {% endif %}

    {% if current_question.images.all %}
      <div class="question-images">
        {% for img in current_question.images.all %}
          <img src="{{ img.image.url }}" alt="Изображение к вопросу">
        {% endfor %}
      </div>
    {% endif %}

    {% if current_question.answers.exists %}
      <form method="post" class="answer-form">
        {% csrf_token %}
        {% for answer in current_question.answers.all %}
          <button class="next-btn" name="answer" value="{{ answer.id }}">{{ answer.text }}</button>
        {% endfor %}
      </form>
    {% else %}
      <form method="post" class="answer-form">
        {% csrf_token %}
        <button class="next-btn" name="next" value="1">Далее</button>
      </form>
    {% endif %}

    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const questionBlock = document.querySelector(".question-block");
    if (questionBlock) {
      questionBlock.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  });
</script>
{% endblock %}

